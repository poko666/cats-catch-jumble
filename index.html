<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>è‹±æ–‡å–®å­—æ‹¼æ‹¼æ¨‚ (å­—æ¯é­šç‰ˆ)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 10px;
      margin: 0;
      background: #e0f7fa;
    }
    h1 { font-size: clamp(20px, 5vw, 32px); }

    #game-container { max-width: 95vw; margin: 0 auto; }

    #letters {
      display: flex; flex-wrap: wrap; justify-content: center;
      margin: 10px auto; gap: 10px;
      position: relative;
      z-index: 1000;
    }

    .fish {
      width: 80px; height: 50px;
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      cursor: pointer;
      user-select: none;
      position: relative;
      z-index: 999;
      transition: transform 0.3s;
    }
    .fish:hover { transform: scale(1.1); }

    #cat {
      margin: 20px auto;
      width: 220px; height: 220px;
      background: url('images/cat.png') no-repeat center;
      background-size: contain;
      position: relative;
      z-index: 10;
      transition: transform 0.1s ease-in-out;
    }

    #mouth {
      position: absolute;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px; height: 60px;
      overflow: hidden;
      pointer-events: none;
      z-index: 20;
    }

    .cat-bite { animation: bite 0.3s ease-in-out; }
    @keyframes bite {
      0% { transform: scaleY(1); }
      30% { transform: scaleY(0.8); }
      60% { transform: scaleY(1.1); }
      100% { transform: scaleY(1); }
    }

    #answer {
      position: relative;
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 5px;
      z-index: 30;
    }

    .slot {
      width: 40px; height: 40px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid #333;
      font-size: 24px;
      font-weight: bold;
      color: #000;
      text-align: center;
      line-height: 40px;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.4);
    }

    .blank-slot { width: 20px; height: 40px; }

    .correct { animation: flashGreen 0.6s ease; }
    @keyframes flashGreen {
      0% { background:#fff; border-color:#333; box-shadow:none; }
      50% { background:#a5d6a7; border-color:#2e7d32; box-shadow:0 0 10px #66bb6a; }
      100% { background:#fff; border-color:#333; box-shadow:none; }
    }

    .wrong { animation: flashRed 0.6s ease; }
    @keyframes flashRed {
      0% { background:#fff; border-color:#333; box-shadow:none; }
      50% { background:#ef9a9a; border-color:#c62828; box-shadow:0 0 10px #ef5350; }
      100% { background:#fff; border-color:#333; box-shadow:none; }
    }

    #progress { margin-top: 20px; font-size: 18px; }
    button {
      margin: 5px; padding: 8px 16px;
      font-size: clamp(14px, 4vw, 18px);
      border-radius: 6px; border: none;
      background: #4caf50; color: white; cursor: pointer;
    }
    button:hover { background:#45a049; }
    .delete-btn { background:#e53935; }
    .delete-btn:hover { background:#c62828; }

    textarea, input, select {
      width: 90%; max-width: 400px;
      margin: 5px auto; padding: 8px;
      font-size: clamp(14px, 4vw, 16px);
      border: 1px solid #ccc; border-radius: 5px;
      display: block;
    }

    #message {
      position: fixed;
      top: 20px; left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 20px;
      font-weight: bold;
      color: white;
      display: none;
      z-index: 2000;
    }
    #message.success { background:#4caf50; }
    #message.error { background:#e53935; }
  </style>
</head>
<body>
  <h1>è‹±æ–‡å–®å­—æ‹¼æ‹¼æ¨‚ ğŸŸâ†’ğŸ±</h1>
  <div id="game-container">

    <h3>å»ºç«‹æ–°çš„å–®å­—æ¸…å–®</h3>
    <textarea id="wordListInput" placeholder="è¼¸å…¥å–®å­—ï¼Œç”¨é€—è™Ÿåˆ†éš” (ä¾‹å¦‚: APPLE,ICE CREAM)"></textarea>
    <input type="text" id="listNameInput" placeholder="æ¸…å–®åç¨±">
    <button onclick="createWordList()">å»ºç«‹æ¸…å–®</button>

    <h3>é¸æ“‡å–®å­—æ¸…å–®</h3>
    <select id="wordListSelect"></select>
    <div>
      <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
      <button onclick="giveHint()">æç¤º</button>
      <button onclick="clearAnswer()">æ¸…é™¤ç­”æ¡ˆ</button>
      <button class="delete-btn" onclick="deleteWordList()">åˆªé™¤æ¸…å–®</button>
    </div>

    <div id="letters"></div>

    <div id="cat">
      <div id="mouth"></div>
    </div>

    <div id="answer"></div>
    <div id="progress"></div>
  </div>

  <div id="message"></div>

  <script>
    let wordLists = {};
    let words = [];
    let currentIndex = 0;
    let correctCount = 0;

    window.onload = () => {
      let savedLists = localStorage.getItem("wordLists");
      if (savedLists) {
        wordLists = JSON.parse(savedLists);
        updateSelectOptions();
      }
    };

    function saveLists(){ localStorage.setItem("wordLists", JSON.stringify(wordLists)); }

    function createWordList() {
      let rawWords = document.getElementById("wordListInput").value.trim();
      let listName = document.getElementById("listNameInput").value.trim();
      if (!rawWords || !listName){ showMessage("è«‹è¼¸å…¥æ¸…å–®åç¨±èˆ‡å–®å­—ï¼","error"); return; }
      let wordArray = rawWords.split(",").map(w=>w.trim().toUpperCase()).filter(w=>w.length>0);
      wordLists[listName] = wordArray;
      updateSelectOptions(); saveLists();
      showMessage(`å·²å»ºç«‹æ¸…å–®ã€Œ${listName}ã€ï¼`,"success");
    }

    function deleteWordList(){
      let select = document.getElementById("wordListSelect");
      let chosenList = select.value;
      if (!chosenList){ showMessage("è«‹å…ˆé¸æ“‡è¦åˆªé™¤çš„æ¸…å–®ï¼","error"); return; }
      if (confirm(`ç¢ºå®šåˆªé™¤æ¸…å–®ã€Œ${chosenList}ã€å—ï¼Ÿ`)){
        delete wordLists[chosenList]; saveLists(); updateSelectOptions();
        showMessage(`å·²åˆªé™¤æ¸…å–®ã€Œ${chosenList}ã€ï¼`,"success");
      }
    }

    function updateSelectOptions(){
      let select = document.getElementById("wordListSelect");
      select.innerHTML = "";
      for (let key in wordLists){
        let option = document.createElement("option");
        option.value = key; option.innerText = key;
        select.appendChild(option);
      }
    }

    function shuffle(array){ return array.sort(()=>Math.random()-0.5); }

    function startGame(){
      let select = document.getElementById("wordListSelect");
      let chosenList = select.value;
      if (!chosenList || !wordLists[chosenList]){
        showMessage("è«‹å…ˆå»ºç«‹ä¸¦é¸æ“‡å–®å­—æ¸…å–®ï¼","error"); return;
      }
      words = shuffle([...wordLists[chosenList]]);
      currentIndex = 0; correctCount = 0;
      loadWord();
    }

    function loadWord(){
      document.getElementById("letters").innerHTML = "";
      document.getElementById("answer").innerHTML = "";

      if (currentIndex >= words.length){
        document.getElementById("progress").innerText=`éŠæˆ²çµæŸï¼å…±ç­”å° ${correctCount} / ${words.length}`;
        return;
      }
      let word = words[currentIndex];
      let letters = shuffle(word.replace(/ /g,"").split(""));
      let lettersDiv = document.getElementById("letters");
      letters.forEach(l=>{
        const fish = document.createElement("div");
        fish.className="fish";
        let imgName = l===" " ? "images/fish_blank.png" : `images/fish_${l}.png`;
        fish.style.backgroundImage=`url('${imgName}')`;
        fish.dataset.letter=l;
        fish.addEventListener("click",()=>{ feedCat(l,fish); });
        lettersDiv.appendChild(fish);
      });
      let answerDiv=document.getElementById("answer");
      for (let i=0;i<word.length;i++){
        if (word[i]===" "){
          let blank=document.createElement("div"); blank.className="blank-slot"; blank.innerText=" ";
          answerDiv.appendChild(blank);
        } else {
          let slot=document.createElement("div"); slot.className="slot";
          answerDiv.appendChild(slot);
        }
      }
      speakWord(word); updateProgress();
    }

    function feedCat(letter,fishEl){
      let slots=document.querySelectorAll("#answer .slot");
      let targetWord = words[currentIndex];
      let nextEmptyIndex = Array.from(slots).findIndex(s => s.innerText === "");
      if (nextEmptyIndex === -1) return;

      let expectedLetter = targetWord.replace(/ /g,"")[nextEmptyIndex];

      if (letter === expectedLetter) {
        // âœ… ç­”å° â†’ å°é­šæ¸¸é€²å˜´å·´
        slots[nextEmptyIndex].innerText = letter;

        let mouth=document.getElementById("mouth");
        let mouthRect=mouth.getBoundingClientRect();
        let targetX=mouthRect.left+mouthRect.width/2;
        let targetY=mouthRect.top+mouthRect.height/2;
        let fishRect=fishEl.getBoundingClientRect();
        let fishX=fishRect.left+fishRect.width/2;
        let fishY=fishRect.top+fishRect.height/2;
        let dx=targetX-fishX; let dy=targetY-fishY;

        fishEl.style.zIndex="999"; fishEl.style.position="fixed";
        fishEl.style.left=fishX-fishRect.width/2+"px";
        fishEl.style.top=fishY-fishRect.height/2+"px";
        fishEl.offsetHeight;
        fishEl.style.transition="transform 0.8s ease-in";
        fishEl.style.transform=`translate(${dx}px, ${dy}px) scale(0.9)`;

        let cat=document.getElementById("cat");
        cat.classList.add("cat-bite");
        setTimeout(()=>{ cat.classList.remove("cat-bite"); },300);

        setTimeout(()=>{ fishEl.style.transition="none"; fishEl.style.position="relative"; },800);
      } else {
        // âŒ ç­”éŒ¯ â†’ å°é­šè·‘èµ°
        fishRunAway(fishEl);
      }

      setTimeout(checkAnswer,200);
    }

    function fishRunAway(fishEl){
      let dx=(Math.random()-0.5)*400;
      let dy=(Math.random()-0.5)*200;
      fishEl.style.transition="transform 0.6s ease";
      fishEl.style.transform=`translate(${dx}px, ${dy}px)`;
      setTimeout(()=>{ fishEl.style.transform="translate(0,0)"; },1000);
    }

    function speakWord(word){
      let utterance=new SpeechSynthesisUtterance(word);
      utterance.lang="en-US"; speechSynthesis.speak(utterance);
    }

    function giveHint(){
      if (words.length>0 && currentIndex<words.length){
        speakWord(words[currentIndex]);
      }
    }

    function checkAnswer(){
      let slots=document.querySelectorAll("#answer .slot, #answer .blank-slot");
      let attempt=Array.from(slots).map(s=>s.innerText).join("");
      if (attempt.replace(/ /g,"").length===words[currentIndex].replace(/ /g,"").length){
        if (attempt===words[currentIndex]){
          // âœ… ç­”å°
          speakWord(words[currentIndex]);
          slots.forEach(s=>s.classList.add("correct"));
          setTimeout(()=>{ slots.forEach(s=>s.classList.remove("correct")); },600);
          showMessage("ç­”å°äº†ï¼","success");
          correctCount++;
          document.querySelectorAll("#letters .fish").forEach(f=>{
            f.style.transition="transform 0.5s ease";
            f.style.transform="scale(0.1)";
            setTimeout(()=>{ f.style.visibility="hidden"; },500);
          });
          setTimeout(()=>{ currentIndex++; loadWord(); },1500);
        } else {
          // âŒ ç­”éŒ¯ â†’ ç•™åœ¨åŒä¸€é¡Œ
          slots.forEach(s=>s.classList.add("wrong"));
          setTimeout(()=>{ slots.forEach(s=>s.classList.remove("wrong")); },600);
          showMessage("ç­”éŒ¯äº†ï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼","error");
        }
      }
    }

    function updateProgress(){
      document.getElementById("progress").innerText=`é€²åº¦ï¼š${currentIndex+1} / ${words.length}ã€€å·²ç­”å°ï¼š${correctCount}`;
    }

    function showMessage(text,type){
      const msg=document.getElementById("message");
      msg.innerText=text; msg.className=type; msg.style.display="block";
      setTimeout(()=>{ msg.style.display="none"; },1500);
    }
  </script>
</body>
</html>
