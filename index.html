<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>è‹±æ–‡å–®å­—æ‹¼æ‹¼æ¨‚ (å­—æ¯é­šç‰ˆ)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 10px;
      margin: 0;
      background: #e0f7fa;
    }
    h1 { font-size: clamp(20px, 5vw, 32px); }

    #game-container { max-width: 95vw; margin: 0 auto; }

    #letters {
      display: flex; flex-wrap: wrap; justify-content: center;
      margin: 10px auto; gap: 10px;
    }

    .fish {
      width: 80px; height: 50px;
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      cursor: pointer;
      user-select: none;
      transition: transform 0.3s;
      position: relative;
    }
    .fish:hover { transform: scale(1.1); }

    #cat {
      margin: 20px auto;
      width: 220px; height: 220px;
      background: url('images/cat.png') no-repeat center;
      background-size: contain;
      position: relative;
      transition: transform 0.1s ease-in-out;
      opacity: 0.9;
    }

    /* ğŸ˜º å˜´å·´å’¬åˆå‹•ç•« */
    .cat-bite {
      animation: bite 0.3s ease-in-out;
    }

    @keyframes bite {
      0%   { transform: scaleY(1); }
      30%  { transform: scaleY(0.8); }
      60%  { transform: scaleY(1.1); }
      100% { transform: scaleY(1); }
    }

    #answer {
      position: absolute;
      bottom: 35px; left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 5px;
    }

    .slot {
      width: 40px; height: 40px;
      border-bottom: 2px solid #555;
      font-size: 24px;
      text-align: center;
      line-height: 40px;
    }

    .blank-slot {
      width: 20px; height: 40px;
    }

    #progress { margin-top: 20px; font-size: 18px; }
    button {
      margin: 5px; padding: 8px 16px;
      font-size: clamp(14px, 4vw, 18px);
      border-radius: 6px; border: none;
      background: #4caf50; color: white; cursor: pointer;
    }
    button:hover { background: #45a049; }
    .delete-btn { background: #e53935; }
    .delete-btn:hover { background: #c62828; }

    textarea, input, select {
      width: 90%; max-width: 400px;
      margin: 5px auto; padding: 8px;
      font-size: clamp(14px, 4vw, 16px);
      border: 1px solid #ccc; border-radius: 5px;
      display: block;
    }
  </style>
</head>
<body>
  <h1>è‹±æ–‡å–®å­—æ‹¼æ‹¼æ¨‚ ğŸŸâ†’ğŸ±</h1>
  <div id="game-container">

    <h3>å»ºç«‹æ–°çš„å–®å­—æ¸…å–®</h3>
    <textarea id="wordListInput" placeholder="è¼¸å…¥å–®å­—ï¼Œç”¨é€—è™Ÿåˆ†éš” (ä¾‹å¦‚: APPLE,ICE CREAM)"></textarea>
    <input type="text" id="listNameInput" placeholder="æ¸…å–®åç¨±">
    <button onclick="createWordList()">å»ºç«‹æ¸…å–®</button>

    <h3>é¸æ“‡å–®å­—æ¸…å–®</h3>
    <select id="wordListSelect"></select>
    <div>
      <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
      <button onclick="giveHint()">æç¤º</button>
      <button onclick="clearAnswer()">æ¸…é™¤ç­”æ¡ˆ</button>
      <button class="delete-btn" onclick="deleteWordList()">åˆªé™¤æ¸…å–®</button>
    </div>

    <div id="letters"></div>

    <div id="cat">
      <div id="answer"></div>
    </div>

    <div id="progress"></div>
  </div>

  <script>
    let wordLists = {};
    let words = [];
    let currentIndex = 0;
    let correctCount = 0;

    window.onload = function() {
      let savedLists = localStorage.getItem("wordLists");
      if (savedLists) {
        wordLists = JSON.parse(savedLists);
        updateSelectOptions();
      }
    }

    function saveLists() { localStorage.setItem("wordLists", JSON.stringify(wordLists)); }

    function createWordList() {
      let rawWords = document.getElementById("wordListInput").value.trim();
      let listName = document.getElementById("listNameInput").value.trim();
      if (!rawWords || !listName) { alert("è«‹è¼¸å…¥æ¸…å–®åç¨±èˆ‡å–®å­—ï¼"); return; }
      let wordArray = rawWords.split(",").map(w => w.trim().toUpperCase()).filter(w => w.length > 0);
      wordLists[listName] = wordArray;
      updateSelectOptions(); saveLists();
      alert(`å·²å»ºç«‹æ¸…å–®ã€Œ${listName}ã€ï¼`);
    }

    function deleteWordList() {
      let select = document.getElementById("wordListSelect");
      let chosenList = select.value;
      if (!chosenList) { alert("è«‹å…ˆé¸æ“‡è¦åˆªé™¤çš„æ¸…å–®ï¼"); return; }
      if (confirm(`ç¢ºå®šåˆªé™¤æ¸…å–®ã€Œ${chosenList}ã€å—ï¼Ÿ`)) {
        delete wordLists[chosenList];
        saveLists();
        updateSelectOptions();
        alert(`å·²åˆªé™¤æ¸…å–®ã€Œ${chosenList}ã€ï¼`);
      }
    }

    function updateSelectOptions() {
      let select = document.getElementById("wordListSelect");
      select.innerHTML = "";
      for (let key in wordLists) {
        let option = document.createElement("option");
        option.value = key;
        option.innerText = key;
        select.appendChild(option);
      }
    }

    function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

    function startGame() {
      let select = document.getElementById("wordListSelect");
      let chosenList = select.value;
      if (!chosenList || !wordLists[chosenList]) {
        alert("è«‹å…ˆå»ºç«‹ä¸¦é¸æ“‡å–®å­—æ¸…å–®ï¼");
        return;
      }
      words = shuffle([...wordLists[chosenList]]);
      currentIndex = 0; correctCount = 0;
      loadWord();
    }

    function loadWord() {
      if (currentIndex >= words.length) {
        document.getElementById("letters").innerHTML = "";
        document.getElementById("answer").innerHTML = "";
        document.getElementById("progress").innerText =
          `éŠæˆ²çµæŸï¼å…±ç­”å° ${correctCount} / ${words.length}`;
        return;
      }

      let word = words[currentIndex];
      let letters = shuffle(word.replace(/ /g, "").split(""));

      let lettersDiv = document.getElementById("letters");
      lettersDiv.innerHTML = "";
      letters.forEach(l => {
        const fish = document.createElement("div");
        fish.className = "fish";
        let imgName;
        if (l === " ") {
          imgName = "images/fish_blank.png";
        } else {
          imgName = `images/fish_${l}.png`;
        }
        fish.style.backgroundImage = `url('${imgName}')`;
        fish.dataset.letter = l;
        fish.addEventListener("click", () => { feedCat(l, fish); });
        lettersDiv.appendChild(fish);
      });

      let answerDiv = document.getElementById("answer");
      answerDiv.innerHTML = "";
      for (let i = 0; i < word.length; i++) {
        if (word[i] === " ") {
          let blank = document.createElement("div");
          blank.className = "blank-slot";
          blank.innerText = " ";
          answerDiv.appendChild(blank);
        } else {
          let slot = document.createElement("div");
          slot.className = "slot";
          answerDiv.appendChild(slot);
        }
      }

      speakWord(word);
      updateProgress();
    }

    function feedCat(letter, fishEl) {
      let slots = document.querySelectorAll("#answer .slot");
      for (let slot of slots) {
        if (slot.innerText === "") {
          slot.innerText = letter;

          // ğŸ¯ ç®—ç›®æ¨™å˜´å·´ä½ç½® (ç­”æ¡ˆå€ä¸­å¿ƒ)
          let answerDiv = document.getElementById("answer");
          let answerRect = answerDiv.getBoundingClientRect();
          let catTargetX = answerRect.left + answerRect.width / 2;
          let catTargetY = answerRect.top + answerRect.height / 2;

          // ğŸŸ ç®—å°é­šä½ç½®
          let fishRect = fishEl.getBoundingClientRect();
          let fishX = fishRect.left + fishRect.width / 2;
          let fishY = fishRect.top + fishRect.height / 2;

          // â¡ï¸ ç§»å‹•é‡
          let dx = catTargetX - fishX;
          let dy = catTargetY - fishY;

          // ğŸŠâ€â™‚ï¸ å°é­šæ¸¸å‘è²“å’ªå˜´å·´
          fishEl.style.transition = "transform 0.8s ease-in";
          fishEl.style.transform = `translate(${dx}px, ${dy}px) scale(0.1)`;

          // ğŸ˜º å˜´å·´å’¬åˆå‹•ç•«
          let cat = document.getElementById("cat");
          cat.classList.add("cat-bite");
          setTimeout(() => { cat.classList.remove("cat-bite"); }, 300);

          // å‹•ç•«å¾Œéš±è—
          setTimeout(() => { fishEl.style.visibility = "hidden"; }, 800);
          break;
        }
      }
      setTimeout(checkAnswer, 200);
    }

    function clearAnswer() {
      let slots = document.querySelectorAll("#answer .slot");
      slots.forEach(s => { s.innerText = ""; });
      let fishes = document.querySelectorAll("#letters .fish");
      fishes.forEach(f => { f.style.visibility = "visible"; f.style.transform = "none"; });
    }

    function speakWord(word) {
      let utterance = new SpeechSynthesisUtterance(word);
      utterance.lang = "en-US";
      speechSynthesis.speak(utterance);
    }

    function giveHint() {
      if (words.length > 0 && currentIndex < words.length) {
        let word = words[currentIndex];
        speakWord(word);
      }
    }

    function fishEscape() {
      let fishes = document.querySelectorAll("#letters .fish");
      fishes.forEach(fish => {
        if (fish.style.visibility !== "hidden") {
          let dx = (Math.random() - 0.5) * 200;
          let dy = (Math.random() - 0.5) * 200;
          fish.style.transition = "transform 0.3s ease";
          fish.style.transform = `translate(${dx}px, ${dy}px)`;
          setTimeout(() => {
            fish.style.transform = "translate(0,0)";
          }, 300);
        }
      });
    }

    function checkAnswer() {
      let slots = document.querySelectorAll("#answer .slot, #answer .blank-slot");
      let attempt = Array.from(slots).map(s => s.innerText).join("");

      if (attempt.replace(/ /g, "").length === words[currentIndex].replace(/ /g, "").length) {
        if (attempt === words[currentIndex]) {
          speakWord(words[currentIndex]);
          alert("ç­”å°äº†ï¼");
          correctCount++;
        } else {
          alert("ç­”éŒ¯äº†ï¼Œå°é­šé€ƒè·‘å•¦ï¼");
          fishEscape();
        }
        setTimeout(() => { currentIndex++; loadWord(); }, 1500);
      }
    }

    function updateProgress() {
      document.getElementById("progress").innerText =
        `é€²åº¦ï¼š${currentIndex + 1} / ${words.length}ã€€å·²ç­”å°ï¼š${correctCount}`;
    }
  </script>
</body>
</html>
